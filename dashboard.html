<!DOCTYPE html>
<html lang="sq">
<head>
<meta charset="utf-8"/>
<title>Auto Parts â€” Dashboard</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
*{box-sizing:border-box;font-family:'Poppins',sans-serif}
body{margin:0;min-height:100vh;display:flex;flex-direction:column;align-items:center;background:linear-gradient(135deg,#0d1b2a,#1b263b,#415a77,#778da9);background-size:400% 400%;animation:gradientMove 10s ease infinite;color:#fff;padding:28px}
@keyframes gradientMove{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
.container{width:100%;max-width:1200px;display:flex;flex-direction:column;gap:20px;padding:10px}
.card{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);border-radius:16px;padding:20px;backdrop-filter:blur(12px);box-shadow:0 8px 30px rgba(0,0,0,0.35)}
h2{margin:0 0 12px 0;text-align:center}
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
label{font-weight:600;font-size:13px;color:#e6eef8}
select,input[type="file"],.searchInput{width:100%;padding:10px;border-radius:10px;border:none;outline:none;background:#fff;color:#000;font-size:14px}
input[type="text"],input[type="number"],textarea{width:100%;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.12);color:#fff;outline:none;font-size:14px}
textarea{resize:vertical}
.full{grid-column:span 3}
.actions{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
button{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600}
.primary{background:linear-gradient(90deg,#00c6ff,#0072ff);color:#fff}
.small{font-size:13px;padding:6px 8px;border-radius:8px}
.msg{min-height:20px;text-align:center;margin-top:8px}
.thumb{width:50px;height:50px;object-fit:cover;border-radius:6px;border:1px solid rgba(0,0,0,0.2)}
.searchInput{flex:1;padding:10px;border-radius:10px;border:none;background:#fff;color:#000;font-size:15px}
.highlight{background:rgba(255,235,59,0.9);color:#000;font-weight:700;padding:0 2px;border-radius:2px}
table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px;background:transparent}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.06);text-align:left;vertical-align:middle}
th{background:rgba(255,255,255,0.04);color:#e9f3ff}
tr:hover{background:rgba(255,255,255,0.03)}





/* ============================= */
/* ğŸ”§ UNIFORM DROPDOWN FIX TOTAL */
/* ============================= */

/* Kutia kryesore pÃ«r tÃ« gjitha dropdown-et */
select,
#model,
#categoryContainer .dropdown,
#partContainer .dropdown {
  width: 100%;
  height: 42px;
  border: none;
  outline: none;
  border-radius: 10px;
  background: #ffffff;
  color: #000000;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  transition: background 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

/* Kur hapet lista â€” ngjitet perfekt, pa hapsirÃ« */
#brand.open,
#fuel.open,
#engine.open,
#categoryContainer .dropdown.open,
#partContainer .dropdown.open {
  border-radius: 10px 10px 0 0;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
}

/* Lista qÃ« hapet poshtÃ« â€” identike si modeli, pa asnjÃ« hapsirÃ« */
.dropdown-list {
  display: none;
  position: absolute;
  top: calc(100% - 1px); /* lidhet perfekt me kutinÃ«, pa vijÃ« nÃ« mes */
  left: 0;
  width: 100%;
  background: #ffffff;
  border-radius: 0 0 10px 10px;
  border-top: 1px solid #ddd;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
  overflow-y: auto;
  max-height: 180px;
  z-index: 999;
  animation: fadeInDropdown 0.15s ease-out;
}


/* Elementet brenda listÃ«s */
.dropdown-list div {
  padding: 10px 12px;
  font-size: 14px;
  color: #000;
  background: #fff;
  cursor: pointer;
  font-weight: 500;
  transition: background 0.15s ease;
}

/* Hover nÃ« opsione */
.dropdown-list div:hover {
  background: #e8f1ff;
}

/* Efekt i butÃ« kur hapet lista */
@keyframes fadeInDropdown {
  from { opacity: 0; transform: translateY(-3px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Rregullim i posaÃ§Ã«m pÃ«r #model qÃ« tÃ« ketÃ« ngjyrÃ« identike */
#model span {
  color: #000;
  font-size: 14px;
  font-weight: 500;
}

/* Kur hapet, bashkon kutinÃ« me listÃ«n pa vijÃ« */
#model.open,
#categoryContainer .dropdown.open,
#partContainer .dropdown.open {
  border-radius: 10px 10px 0 0;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
}



/* Efekt i lehtÃ« kur hapet */
@keyframes dropdownSmooth {
  from { opacity: 0; transform: translateY(-3px); }
  to { opacity: 1; transform: translateY(0); }
}


/* Korrigjim qÃ« dropdown-et tÃ« hapen brenda kufijve tÃ« vet, si modeli */
#categoryContainer,
#partContainer {
  position: relative;
  overflow: visible;
}


/* Siguro qÃ« modeli dhe dropdown-et qÃ«ndrojnÃ« nÃ« vendin e tyre */
#model {
  position: relative;
  overflow: visible;
  z-index: 1000; /* mban dropdown-in mbi tÃ« tjerÃ«t */
}

#categoryContainer,
#partContainer {
  position: relative;
  overflow: visible;
  z-index: 999;
}



/* Rregullim i stilit pÃ«r markÃ«, karburant dhe kubikazh */

#fuel,
#engine {
  border-radius: 10px;
  border: none;
  outline: none;
  background: #ffffff;
  color: #000000;
  font-size: 14px;
  font-weight: 500;
  height: 42px;
  width: 100%;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  padding: 0 12px;
  appearance: none;
  position: relative;
  cursor: pointer;
}

/* Kur hapet dropdown-i i tyre */

#fuel:focus,
#engine:focus {
  background: #f3f6ff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.25);
}

/* Rregullon dropdown-in e tyre qÃ« tÃ« jetÃ« ngjitur perfekt */
select {
  background-position: right 12px center;
  background-repeat: no-repeat;
  background-size: 12px;
  overflow: hidden;
}



/* âœ… Rregullim vizual i plotÃ« pÃ«r Marka, Karburant dhe Kubikazh */
select#brand,
select#fuel,
select#engine {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  width: 100%;
  height: 42px;
  border: none;
  border-radius: 10px;
  background: #ffffff;
  color: #000;
  font-size: 14px;
  font-weight: 500;
  padding: 0 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  outline: none;
  transition: all 0.15s ease-in-out;
  cursor: pointer;
  line-height: 42px;
}

/* Kur hapet dropdown-i (ngjitet si modeli, pa hapÃ«sirÃ«) */
select#brand:focus,
select#fuel:focus,
select#engine:focus {
  background: #f3f6ff;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
}

/* Hiq vijÃ«n blu tÃ« fokusit qÃ« prish pamjen */
select#brand:focus-visible,
select#fuel:focus-visible,
select#engine:focus-visible {
  outline: none;
}

/* Ikona poshtÃ« (shigjeta) â€“ njÃ«soj pÃ«r tÃ« gjitha */
select#brand::-ms-expand,
select#fuel::-ms-expand,
select#engine::-ms-expand {
  display: none;
}

/* Mbushje dhe kufij identikÃ« si dropdown i Modelit */
select#brand,
select#fuel,
select#engine {
  background-position: right 12px center;
  background-repeat: no-repeat;
  background-size: 12px;
}





@media(max-width:1000px){.grid{grid-template-columns:repeat(2,1fr)}.full{grid-column:span 2}}
@media(max-width:600px){.grid{grid-template-columns:1fr}.full{grid-column:span 1}}



/* ğŸ”§ Stili i ri pÃ«r dropdown custom â€” identik me modelin */
.dropdown {
  width: 100%;
  height: 42px;
  border: none;
  outline: none;
  border-radius: 10px;
  background: #ffffff;
  color: #000000;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  position: relative;
}

.dropdown.open {
  border-radius: 10px 10px 0 0;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
}

.dropdown-list {
  display: none;
  position: absolute;
  top: 42px;
  left: 0;
  width: 100%;
  background: #ffffff;
  border-radius: 0 0 10px 10px;
  border-top: 1px solid #ccc;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
  overflow-y: auto;
  max-height: 160px;
  z-index: 999;
}

.dropdown-list div {
  padding: 10px 12px;
  font-size: 14px;
  color: #000;
  background: #fff;
  cursor: pointer;
  transition: background 0.15s ease;
}

.dropdown-list div:hover {
  background: #e8f1ff;
}


/* âœ… Stil vetÃ«m pÃ«r dropdown-et e reja (MarkÃ«, Karburant, Kubikazh) */
.custom-select {
  width: 100%;
  height: 42px;
  border: none;
  outline: none;
  border-radius: 10px;
  background: #ffffff;
  color: #000;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  position: relative;
  z-index: 900;
}

.custom-select.open {
  border-radius: 10px 10px 0 0;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
}

.custom-list {
  display: none;
  position: absolute;
  top: 42px;
  left: 0;
  width: 100%;
  background: #fff;
  border-radius: 0 0 10px 10px;
  border-top: 1px solid #ccc;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
  overflow-y: auto;
  max-height: 160px;
  z-index: 999;
}

.custom-list div {
  padding: 10px 12px;
  font-size: 14px;
  color: #000;
  background: #fff;
  cursor: pointer;
  transition: background 0.15s ease;
}

.custom-list div:hover {
  background: #e8f1ff;
}


/* âœ… Rregullim final pÃ«r dropdown custom tÃ« MarkÃ«, Karburant, Kubikazh */
.custom-select {
  width: 100%;
  height: 42px;
  border: none;
  outline: none;
  border-radius: 10px;
  background: #ffffff;
  color: #000;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  position: relative;
  z-index: 900;
}

/* Kur hapet â€” bashkohet pa hapsirÃ« */
.custom-select.open {
  border-radius: 10px 10px 0 0;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
}

/* Lista poshtÃ« */
.custom-list {
  display: none;
  position: absolute;
  top: 42px;
  left: 0;
  width: 100%;
  background: #fff;
  border-radius: 0 0 10px 10px;
  border-top: 1px solid #ccc;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
  overflow-y: auto;
  max-height: 160px;
  z-index: 999;
}

/* Pamja e opsioneve */
.custom-list div {
  padding: 10px 12px;
  font-size: 14px;
  color: #000;
  background: #fff;
  cursor: pointer;
  transition: background 0.15s ease;
}

.custom-list div:hover {
  background: #e8f1ff;
}

/* Korrigjim pÃ«r skajet â€” sâ€™mÃ« lejon mÃ« â€œgapâ€ nÃ« mes */
.custom-select,
.custom-list {
  border: none;
}

/* âœ… Stil pÃ«r dropdown e markÃ«s, karburantit dhe kubikazhit */
.custom-dropdown {
  width: 100%;
  height: 42px;
  border-radius: 10px;
  background: #fff;
  color: #000;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  position: relative;
}

.custom-dropdown.open {
  border-radius: 10px 10px 0 0;
  box-shadow: 0 3px 10px rgba(0,0,0,0.25);
}

.custom-dropdown-list {
  display: none;
  position: absolute;
  top: 42px;
  left: 0;
  width: 100%;
  background: #ffffff;
  border-radius: 0 0 10px 10px;
  border-top: 1px solid #ccc;
  box-shadow: 0 3px 10px rgba(0,0,0,0.25);
  overflow-y: auto;
  max-height: 160px;
  z-index: 999;
}

.custom-dropdown-list div {
  padding: 10px 12px;
  font-size: 14px;
  color: #000;
  cursor: pointer;
  transition: background 0.15s ease;
}

.custom-dropdown-list div:hover {
  background: #e8f1ff;
}

/* âœ… VetÃ«m pÃ«r dropdown e MarkÃ«s, Karburantit dhe Kubikazhit */
.custom-select-box {
  width: 100%;
  height: 42px;
  border-radius: 10px;
  background: #ffffff;
  color: #000;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  position: relative;
}
.custom-select-box.open {
  border-radius: 10px 10px 0 0;
  box-shadow: 0 3px 10px rgba(0,0,0,0.25);
}
.custom-options-box {
  display: none;
  position: absolute;
  top: 42px;
  left: 0;
  width: 100%;
  background: #ffffff;
  border-radius: 0 0 10px 10px;
  border-top: 1px solid #ccc;
  box-shadow: 0 3px 10px rgba(0,0,0,0.25);
  overflow-y: auto;
  max-height: 160px;
  z-index: 999;
}
.custom-options-box div {
  padding: 10px 12px;
  font-size: 14px;
  color: #000;
  cursor: pointer;
}
.custom-options-box div:hover {
  background: #e8f1ff;
}


/


/* âœ… 2. Rregullon â€œKategoria e pjesÃ«veâ€ dhe â€œEmri i pjesÃ«sâ€ qÃ« dropdown-i tÃ« hapet poshtÃ«, jo lart */
#categoryContainer .dropdown-list,
#partContainer .dropdown-list {
  position: absolute;
  top: 42px !important;   /* i bÃ«n tÃ« hapen direkt poshtÃ« kutisÃ« */
  left: 0;
  width: 100%;
  background: #fff;
  border-radius: 0 0 10px 10px;
  border-top: 1px solid #ccc;
  box-shadow: 0 3px 10px rgba(0,0,0,0.25);
  overflow-y: auto;
  max-height: 160px;
  z-index: 999;
  margin: 0;
  padding: 0;
}

/* âœ… 3. E bashkon pamjen me â€œModelinâ€ (pa gap nÃ« mes) */
#categoryContainer .dropdown.open,
#partContainer .dropdown.open {
  border-radius: 10px 10px 0 0;
  box-shadow: 0 3px 10px rgba(0,0,0,0.25);
}


/* âœ… Rregullim final pÃ«r "Kategoria e pjesÃ«ve" dhe "Emri i pjesÃ«s" */
#categoryContainer,
#partContainer {
  position: relative;
  overflow: visible;
}

#categoryContainer .dropdown-list,
#partContainer .dropdown-list {
  top: calc(100% - 1px) !important; /* lidhet perfekt poshtÃ« kutisÃ« */
  left: 0;
  width: 100%;
  border-radius: 0 0 10px 10px;
  background: #ffffff;
  border-top: 1px solid #ccc;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
  margin: 0;
  padding: 0;
  z-index: 999;
}

/* Kur hapen, forma identike si e MarkÃ«s */
#categoryContainer .dropdown.open,
#partContainer .dropdown.open {
  border-radius: 10px 10px 0 0;
  box-shadow: 0 3px 10px rgba(0,0,0,0.25);
}








/* âœ… Ngjyra dhe stili i MarkÃ«s identik me Modelin */
#brand {
  background: #ffffff !important;
  color: #000 !important;
  border: none !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
}

/* Hiq vijÃ«n e errÃ«t ndarÃ«se midis kutisÃ« dhe listÃ«s */
#brand,
#brand:focus,
#brand option,
select#brand {
  border: none !important;
  outline: none !important;
}

/* Lista e opsioneve e MarkÃ«s (e njÃ«jtÃ« si modeli) */
#brand option {
  background: #fff !important;
  color: #000 !important;
  border: none !important;
}

/* Kur hapet, ngjyra mbetet e njÃ«jtÃ« pa hije mÃ« tÃ« errÃ«t */
#brand:focus {
  background: #f3f6ff !important;
  border-radius: 10px 10px 0 0 !important;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25) !important;
}



/* âœ… Rregullim pÃ«r butonin Ruaj qÃ« tÃ« mos ndikohet nga dropdown-et */
.actions button {
  position: relative;
  z-index: 10; /* ngritet mbi Ã§do dropdown */
  background: linear-gradient(90deg,#00c6ff,#0072ff);
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 10px 18px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.1s ease, box-shadow 0.2s ease;
}

.actions button:hover {
  transform: scale(1.03);
  box-shadow: 0 0 10px rgba(0,114,255,0.5);
}

.actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 12px;
  z-index: 5; /* mban butonat mbi dropdown */
}

#fuel, #engine {
  appearance: none;
  border-radius: 10px;
  background: #fff;
  color: #000;
  height: 42px;
  padding: 0 12px;
  font-weight: 500;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  border: none;
  outline: none;
  cursor: pointer;
}


.logout-btn {
  background: linear-gradient(135deg, #ff3b3b, #b30000);
  color: #fff;
  font-weight: 600;
  border: none;
  border-radius: 12px;
  padding: 10px 20px;
  font-size: 14px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(255, 0, 0, 0.35);
  transition: all 0.25s ease-in-out;
  display: flex;
  align-items: center;
  gap: 8px;
}

.logout-btn:hover {
  background: linear-gradient(135deg, #ff1a1a, #800000);
  box-shadow: 0 0 18px rgba(255, 60, 60, 0.7);
  transform: scale(1.06);
}

.logout-btn:active {
  transform: scale(0.96);
  box-shadow: 0 0 8px rgba(255, 60, 60, 0.5);
}

.searchBtn {
  padding: 10px 16px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 14px;
  transition: all 0.25s ease;
}

.searchBtn.primary {
  background: linear-gradient(90deg, #0072ff, #00c6ff);
  color: white;
  box-shadow: 0 4px 12px rgba(0, 114, 255, 0.35);
}

.searchBtn.primary:hover {
  background: linear-gradient(90deg, #005ce6, #0099ff);
  transform: scale(1.05);
}

.searchBtn.danger {
  background: linear-gradient(90deg, #ff4b2b, #ff416c);
  color: white;
  box-shadow: 0 4px 12px rgba(255, 65, 65, 0.35);
}

.searchBtn.danger:hover {
  background: linear-gradient(90deg, #ff1a1a, #cc0033);
  transform: scale(1.05);
}



/* Efekt ndriÃ§imi pÃ«r butonin "KÃ«rko" */
#searchButton.flash {
  box-shadow: 0 0 18px #ff9900;
  background: linear-gradient(90deg, #ffb347, #ffcc33);
  color: #000;
  transform: scale(1.1);
  transition: all 0.3s ease;
}





@keyframes fadeInMsg {
  from {opacity:0; transform:translateY(-6px);}
  to {opacity:1; transform:translateY(0);}
}



.photo-stack {
  position: relative;
  width: 50px;
  height: 50px;
  display: inline-block;
  cursor: pointer;
}

.photo-stack .main-photo {
  width: 50px;
  height: 50px;
  border-radius: 6px;
  border: 1px solid rgba(0, 0, 0, 0.2);
  object-fit: cover;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
}

/* Efekt qÃ« duket si shumÃ« foto */
.photo-stack::before,
.photo-stack::after {
  content: "";
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 6px;
  background: rgba(255,255,255,0.6);
  top: 3px;
  left: 3px;
  z-index: -1;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
.photo-stack::after {
  top: 6px;
  left: 6px;
  opacity: 0.8;
}

/* Numri i fotove tjera (+3) */
.photo-overlay {
  position: absolute;
  bottom: 2px;
  right: 4px;
  background: rgba(0, 0, 0, 0.6);
  color: #fff;
  font-size: 12px;
  font-weight: 600;
  padding: 2px 5px;
  border-radius: 6px;
}



.photo-stack {
  position: relative;
  width: 50px;
  height: 50px;
  display: inline-block;
  cursor: pointer;
}

/* Foto kryesore */
.photo-stack .main-photo {
  width: 50px;
  height: 50px;
  border-radius: 6px;
  border: 1px solid rgba(0,0,0,0.2);
  object-fit: cover;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}

/* Efekti â€œstackâ€ vetÃ«m pÃ«r ato qÃ« kanÃ« mÃ« shumÃ« se njÃ« foto */
.photo-stack.multi::before,
.photo-stack.multi::after {
  content: "";
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 6px;
  background: rgba(255,255,255,0.6);
  top: 3px;
  left: 3px;
  z-index: -1;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
.photo-stack.multi::after {
  top: 6px;
  left: 6px;
  opacity: 0.8;
}

/* Numri i fotove shtesÃ« (+3) */
.photo-overlay {
  position: absolute;
  bottom: 2px;
  right: 4px;
  background: rgba(0,0,0,0.6);
  color: #fff;
  font-size: 12px;
  font-weight: 600;
  padding: 2px 5px;
  border-radius: 6px;
}

/* Pa efekt pÃ«r njÃ« foto */
.photo-stack.single::before,
.photo-stack.single::after {
  display: none;
}




#imagePopup {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100vh;
  background: rgba(0,0,0,0.92);
  justify-content: center;
  align-items: center;
  z-index: 999999999;
}

#imagePopup img {
  max-width: 95%;
  max-height: 90vh;
  border-radius: 14px;
  box-shadow: 0 0 40px rgba(255,255,255,0.3);
  background: #000;
  cursor: zoom-out;
  animation: zoomIn 0.25s ease;
}

@keyframes zoomIn {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}


#imagePopup {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100vh;
  background: rgba(0, 0, 0, 0.92);
  justify-content: center;
  align-items: center;
  z-index: 999999999;
}

#imagePopup img {
  max-width: 95%;
  max-height: 90vh;
  border-radius: 14px;
  box-shadow: 0 0 40px rgba(255,255,255,0.3);
  background: #000;
  cursor: zoom-out;
  animation: zoomIn 0.25s ease;
}

/* âœ… MadhÃ«si identike pÃ«r butonat "Pastro" dhe "KÃ«rko" */
.searchBtn {
  padding: 10px 20px !important;
  height: 42px !important;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
}


#searchButton {
  min-width: 90px;
}

@media (max-width: 600px) {
  .grid > div {
    margin-bottom: 12px;
  }
  button, .searchBtn {
    width: 100%;
  }
  .actions {
    flex-direction: column;
    align-items: stretch;
  }
}


/* ğŸ“¦ Scroll horizontal pÃ«r tabelÃ«n nÃ« ekrane tÃ« vegjÃ«l */
.table-container {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch; /* pÃ«r telefonat */
}

#partsTable {
  min-width: 1100px; /* gjerÃ«si minimale qÃ« lejon scroll */
  border-collapse: collapse;
  width: 100%;
}



.stats-container {
  display: flex;
  justify-content: flex-start;
  gap: 20px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

.stat-box {
  display: flex;
  align-items: center;
  gap: 15px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 16px;
  padding: 16px 22px;
  color: #fff;
  box-shadow: 0 6px 15px rgba(0,0,0,0.3);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  backdrop-filter: blur(10px);
}

.stat-box:hover {
  transform: scale(1.05);
  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}

.stat-icon {
  font-size: 36px;
}

.stat-info h3 {
  margin: 0;
  font-size: 26px;
  font-weight: 700;
}

.stat-info p {
  margin: 0;
  font-size: 14px;
  color: #d1e9ff;
}

/* ğŸ¨ Stil pÃ«r butonat e veprimeve */
td button.small {
  border: none;
  border-radius: 8px;
  padding: 6px 10px;
  margin: 0 2px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s ease;
}

td button[data-action="edit"] {
  background: linear-gradient(90deg, #0072ff, #00c6ff);
  color: #fff;
}
td button[data-action="delete"] {
  background: linear-gradient(90deg, #ff4b2b, #ff416c);
  color: #fff;
}
td button[data-action="invoice"] {
  background: linear-gradient(90deg, #2ecc71, #27ae60);
  color: #fff;
}

/* Hover efekti */
td button.small:hover {
  transform: scale(1.08);
  box-shadow: 0 0 10px rgba(255,255,255,0.4);
}

/* Efekt klikimi (pulse) */
td button.small:active {
  transform: scale(0.95);
  box-shadow: 0 0 6px rgba(255,255,255,0.3);
  filter: brightness(1.2);
}

/* ğŸ“¦ Scroll horizontal vetÃ«m pÃ«r tabelÃ«n e pjesÃ«ve */
#partsCard {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 10px;
}

#partsCard table {
  min-width: 1200px; /* pÃ«rshtate sipas nevojÃ«s */
  border-collapse: collapse;
  width: 100%;
  background: transparent;
}


/* âœ… Zona e butonave lart djathtas */
.top-buttons {
  position: fixed;
  top: 16px;
  right: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  z-index: 9999;
}

/* âœ… Stili i pÃ«rbashkÃ«t pÃ«r tÃ« dy butonat */
.top-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 42px;
  height: 42px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-size: 20px;
  color: #fff;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  transition: all 0.25s ease;
}

/* Shto pÃ«rdorues */
.top-btn.add {
  background: linear-gradient(135deg,#2ecc71,#27ae60);
}
.top-btn.add:hover {
  background: linear-gradient(135deg,#38d87c,#219150);
  transform: scale(1.08);
}

/* Dalje */
.top-btn.logout {
  background: linear-gradient(135deg,#ff3b3b,#b30000);
}
.top-btn.logout:hover {
  background: linear-gradient(135deg,#ff1a1a,#8b0000);
  transform: scale(1.08);
}



/* ğŸ”„ Butoni Rifresko â€“ pamje moderne */
#refreshBtn {
  background: linear-gradient(135deg, #00bcd4, #008c9e);
  color: #fff;
  font-weight: 600;
  border: none;
  border-radius: 10px;
  padding: 8px 14px;
  cursor: pointer;
  box-shadow: 0 3px 10px rgba(0, 188, 212, 0.3);
  transition: all 0.3s ease;
}

#refreshBtn:hover {
  transform: scale(1.08);
  box-shadow: 0 0 15px rgba(0, 188, 212, 0.6);
}

#refreshBtn:active {
  transform: scale(0.95);
  background: linear-gradient(135deg, #0097a7, #006978);
}

/* Efekti i rrotullimit kur klikohet */
#refreshBtn.loading {
  animation: spin 0.8s linear infinite;
  background: linear-gradient(135deg, #00e5ff, #00acc1);
  box-shadow: 0 0 20px rgba(0, 229, 255, 0.7);
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}


/* ğŸ¯ Butonat â€œPastroâ€ dhe â€œKÃ«rkoâ€ mÃ« tÃ« vogÃ«l & elegant */
.searchBtn {
  padding: 8px 14px !important;
  height: 38px !important;
  border-radius: 8px;
  font-size: 13px;
  font-weight: 600;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 3px 8px rgba(0,0,0,0.25);
  transition: all 0.25s ease;
}

/* Butoni KÃ«rko */
.searchBtn.primary {
  background: linear-gradient(90deg, #0072ff, #00c6ff);
  color: #fff;
}
.searchBtn.primary:hover {
  background: linear-gradient(90deg, #005ce6, #00a8ff);
  transform: scale(1.05);
}

/* Butoni Pastro */
.searchBtn.danger {
  background: linear-gradient(90deg, #ff4b2b, #ff416c);
  color: #fff;
}
.searchBtn.danger:hover {
  background: linear-gradient(90deg, #ff1a1a, #cc0033);
  transform: scale(1.05);
}
-----------------------------------------------------

/* âœ… Rregullim final pÃ«r "Kategoria e pjesÃ«ve" dhe "Emri i pjesÃ«s" */
#categoryContainer .dropdown-list,
#partContainer .dropdown-list {
  top: calc(100% - 1px) !important;
  left: 0;
  width: 100%;
  border-radius: 0 0 10px 10px;
  background: #ffffff;
  border-top: 1px solid #ccc;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
  margin: 0;
  padding: 0;
  z-index: 999;
}



/* âœ… Rregullim qÃ« â€œMotoriâ€ (engineBox) tÃ« duket identik me dropdown-et tjera */
#engineBox {
  width: 100%;
  height: 42px;
  border-radius: 10px;
  background: #ffffff !important;
  color: #000 !important;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 12px;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  position: relative;
  border: none !important;
}

/* Kur hapet dropdown-i */
#engineBox.open {
  border-radius: 10px 10px 0 0;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.25);
}

/* Teksti i motorit */
#engineBox span {
  color: #000 !important;
  font-size: 14px;
  font-weight: 500;
}

/* Lista e motorÃ«ve poshtÃ« (e njÃ«jtÃ« me modelin) */
#engineBox .dropdown-list {
  display: none;
  position: absolute;
  top: 42px;
  left: 0;
  width: 100%;
  background: #ffffff;
  border-radius: 0 0 10px 10px;
  border-top: 1px solid #ccc;
  box-shadow: 0 3px 10px rgba(0,0,0,0.25);
  overflow-y: auto;
  max-height: 160px;
  z-index: 999;
}

#engineBox .dropdown-list div {
  padding: 10px 12px;
  font-size: 14px;
  cursor: pointer;
  color: #000;
}

#engineBox .dropdown-list div:hover {
  background: #e8f1ff;
}


/* âœ… BÃ«je PÃ‹RSHKRIMIN tÃ« duket si input normal */
#note {
  width: 100%;
  height: 42px;
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: rgba(255,255,255,0.12);
  color: #fff;
  outline: none;
  font-size: 14px;
  resize: none;
}




.action-buttons button {
  background: #1e2a38;
  color: #fff;
  border: none;
  padding: 8px 12px;
  margin-right: 5px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
}

.action-buttons button:hover {
  background: #2a3d52;
}

.label-btn {
  background: #0d6efd; /* ngjyrÃ« si buton kryesor */
}

.label-btn:hover {
  background: #0b5ed7;
}





</style>
</head>
<body>

  <div class="container">
		<div class="top-buttons">
  <button id="addUserBtn" class="top-btn add" title="Shto pÃ«rdorues">â•</button>
   <button id="reportBtn" class="top-btn report" title="Raporti">ğŸ“Š</button>
  <button id="logoutBtn" class="top-btn logout" title="Dalje">ğŸ”’</button>
</div>

    <!-- Regjistrimi -->
    <div class="card">
      <h2>âš™ï¸ Regjistro dhe PÃ«rditÃ«so PjesÃ«</h2>
      <div class="grid">
        <div>
          <label>Marka</label>
          <select id="brand"></select>
        </div>

        <div>
          <label>Modeli</label>
          <div id="model"><span>-- Zgjidh --</span></div>
          <input type="hidden" id="modelValue"/>
        </div>




<!-- ZÃ‹VENDÃ‹SO bllokun e vjetÃ«r tÃ« MOTORI-t dhe HIQ fare bllokun 'Kubikazha' -->
<div>
  <label>Motori</label>
  <div id="engineBox"><span>-- Zgjidh --</span></div>
  <input type="hidden" id="fuelValue"/>
  <input type="hidden" id="engineValue"/>
</div>




        <div id="categoryContainer">
          <label>Kategoria e pjesÃ«ve</label>
          <div class="dropdown"><span>Zgjidh kategorinÃ«</span><input type="hidden" id="categoryValue"/></div>
        </div>

        <div id="partContainer">
          <label>Emri i pjesÃ«s</label>
          <div class="dropdown"><span>Zgjidh emrin e pjesÃ«s</span><input type="hidden" id="partValue"/></div>
        </div>

        <div>
  <label>PÃ«rshkrimi</label>
  <input id="note" type="text" placeholder="Opsionale"/>
</div>


        

        <div>
          <label>Sasia</label>
          <input id="qty" type="number" value="1" min="0"/>
        </div>

<div>
  <label>Lokacion (magazina)</label>
  <input id="location" type="text" placeholder="P.sh. Kati 2, Rendi 1"/>
</div>

        <div>
          <label>Ã‡mimi (EUR)</label>
          <input id="price" type="number" step="0.01"/>
        </div>

        
 
        
        <div>
          <label>Foto e pjesÃ«s</label>
          <input id="image" type="file" accept="image/*" multiple />
		  <small id="photoHint" 
       style="display:block;
              margin-top:6px;
              color:#ffd966;
              font-size:13px;
              font-weight:500;">
  â„¹ï¸ Mund tÃ« ngarkosh maksimum <b>5 foto</b> pÃ«r Ã§do pjesÃ«.
</small>


        </div>
		<div class="image-popup" id="imagePopup">
  <img id="popupImg" src="" alt="Foto e madhe" />
</div>

<div id="photoLimitMsg" 
     style="display:none; 
            background:rgba(255, 75, 75, 0.9);
            color:#fff;
            padding:10px 16px;
            border-radius:8px;
            margin-top:10px;
            text-align:center;
            font-weight:600;
            box-shadow:0 3px 12px rgba(0,0,0,0.25);
            animation: fadeInMsg 0.3s ease;">
  âŒ Nuk mund tÃ« futesh mÃ« shumÃ« se 5 foto! VetÃ«m 5 tÃ« parat do tÃ« ruhen.
</div>


        <div class="full actions">
          <button id="saveBtn" class="primary">ğŸ’¾ Ruaj</button>
          <button id="updateBtn" class="primary" style="display:none">âœï¸ PÃ«rditÃ«so</button>
          <button id="cancelEdit" class="small" style="display:none">Anulo</button>
        </div>
        <div class="full msg" id="msg"></div>
      </div>
    </div>

    <!-- KÃ«rkimi -->
    <div class="card">
      <h2>ğŸ” KÃ«rko pjesÃ«</h2>
	  
      <div class="searchRow" style="display:flex;gap:10px;align-items:center">
  <input id="searchInput" class="searchInput" type="text" placeholder="Shkruaj markÃ«, model, OEM, pÃ«rshkrim, karburant, kubikazh, lokacion... (ENTER)" />
  <button id="clearSearch" class="searchBtn danger">Pastro</button>
  <button id="searchButton" class="searchBtn primary">ğŸ” KÃ«rko</button>
</div>

	  
      <div style="margin-top:12px;display:flex;gap:10px">
        <button id="exportCSV" class="small">Eksporto CSV</button>
        <button id="exportPDF" class="small">Eksporto PDF</button>
      </div>
    </div>


<div class="stats-container">
  <div class="stat-box">
    <div class="stat-icon">ğŸ“¦</div>
    <div class="stat-info">
      <h3 id="totalParts">0</h3>
      <p>PjesÃ« tÃ« regjistruara</p>
    </div>
  </div>

  <div class="stat-box">
    <div class="stat-icon">ğŸ’°</div>
    <div class="stat-info">
      <h3 id="totalValue">0 â‚¬</h3>
      <p>Vlera totale e pjesÃ«ve</p>
    </div>
  </div>
</div>




    <!-- Tabela -->
    <div class="card" id="partsCard">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2 style="margin:0">ğŸ“¦ PjesÃ«t e regjistruara</h2>
        <div>
          <button id="refreshBtn" class="small">ğŸ”„ Rifresko</button>
        </div>
		
		
		
      </div>

      <table id="partsTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Foto</th>
            <th>Marka</th>
            <th>Modeli</th>
            <th>Kategoria</th>
            <th>Emri i pjesÃ«s</th>
            <th>Karburanti</th>
            <th>Kubikazhi</th>
            <th>Sasia</th>
            <th>Ã‡mimi (EUR)</th>
            <th>PÃ«rshkrimi</th>
            <th>Lokacioni</th>
            <th>Krijuar mÃ«</th>
            <th>Veprime</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>


<div class="table-container">
  <table id="partsTable">
    <!-- kolonat dhe rreshtat -->
  </table>
</div>

</div>   <!-- mbyll container-in kryesor -->

<!-- âœ… POPUP RAPORTI VENDOSE KÃ‹TU -->
<div id="reportPopup" 
     style="display:none; position:fixed; top:0; left:0; width:100%; height:100vh;
            background:rgba(0,0,0,0.8); backdrop-filter:blur(4px);
            justify-content:center; align-items:center; z-index:999999;">

  <div style="background:#1e2a38; padding:25px; border-radius:14px; width:90%; max-width:900px;
              color:white; box-shadow:0 0 20px rgba(0,0,0,0.5); position:relative;">

    <div id="closeReport" 
         style="position:absolute; top:10px; right:14px; font-size:26px; cursor:pointer;">
      âŒ
    </div>

    <div id="reportContent"></div>

  </div>
</div>





<!-- âœ… Popup fshirje me opsion shitje -->
<div id="deletePopup" 
     style="display:none; position:fixed; top:0; left:0; width:100%; height:100vh;
            background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:999999;">
  
  <div style="background:#1e2a38; padding:20px; border-radius:12px; width:320px; text-align:center; color:white;">
    
    <h3>Fshij pjesÃ«n</h3>
    <p>A e ke shitur kÃ«tÃ« pjesÃ«?</p>

    <button id="btnSold" style="margin:10px; padding:8px 20px; background:#4caf50; border:none; border-radius:8px; cursor:pointer;">
      âœ… E shita
    </button>

    <button id="btnNotSold" style="margin:10px; padding:8px 20px; background:#f44336; border:none; border-radius:8px; cursor:pointer;">
      ğŸ—‘ï¸ VetÃ«m fshije
    </button>

    <button id="btnCancel" style="margin-top:15px; padding:6px 16px; background:#aaa; border:none; border-radius:6px;">
      Anulo
    </button>
  </div>
</div>










<script>


/* ====== MARKA / MODELI / NÃ‹N-MODELI / MOTOR ====== */
const VEHICLES = {
  "Volkswagen": {
    "Golf": {
      "Golf 1": {
        "Benzin": ["1.0", "1.1", "1.3", "1.5", "1.6"],
        "Dizel": ["1.5D", "1.6D", "1.6TD"]
      },
      "Golf 2": {
        "Benzin": ["1.3", "1.6", "1.8", "2.0"],
        "Dizel": ["1.6D", "1.6TD"]
      },
      "Golf 3": {
        "Benzin": ["1.4", "1.6", "1.8", "2.0"],
        "Dizel": ["1.9D", "1.9SDI", "1.9TDI"]
      }
    },

    "Passat": {
      "Passat B3": {
        "Benzin": ["1.6", "1.8", "2.0"],
        "Dizel": ["1.9D", "1.9TD"]
      },
      "Passat B4": {
        "Benzin": ["1.6", "1.8", "2.0"],
        "Dizel": ["1.9TDI"]
      }
    }
  },

  "BMW": {
    "Series 3": {
      "E36": {
        "Benzin": ["316i", "318i", "320i", "323i", "325i", "328i"],
        "Dizel": ["318tds"]
      },
      "E46": {
        "Benzin": ["316i", "318i", "320i", "325i", "328i", "330i"],
        "Dizel": ["320d", "330d"]
      }
    }
  },

  "Audi": {
    "A4": {
      "B5": {
        "Benzin": ["1.6", "1.8", "1.8T", "2.4", "2.8"],
        "Dizel": ["1.9TDI"]
      },
      "B6": {
        "Benzin": ["1.6", "1.8T", "2.0", "3.0"],
        "Dizel": ["1.9TDI", "2.5TDI"]
      }
    }
  }
};






// helper i thjeshtÃ«
const $ = (id) => document.getElementById(id);

// Ngarko markat nga VEHICLES
function loadBrands() {
  const brand = $("brand");
  brand.innerHTML = `<option value="">-- Zgjidh --</option>`;
  Object.keys(VEHICLES).forEach(b => {
    const opt = document.createElement("option");
    opt.value = b; opt.textContent = b;
    brand.appendChild(opt);
  });
}

// MODELI me nÃ«n-modele (punon me VEHICLES)
function renderModelsWithSubModels() {
  const brandName = $("brand").value;
  const brandObj = VEHICLES[brandName];

  const container = $("model");
  const old = container.querySelector(".dropdown-list");
  if (old) old.remove();

  $("modelValue").value = "";
  container.querySelector("span").textContent = "-- Zgjidh --";

  if (!brandObj) return;

  const list = document.createElement("div");
  list.className = "dropdown-list";

  Object.keys(brandObj).forEach(mainModel => {
    const item = document.createElement("div");
    item.style.display = "flex";
    item.style.justifyContent = "space-between";
    const name = document.createElement("span");
    name.textContent = mainModel;
    const toggle = document.createElement("span");
    toggle.textContent = "+";
    toggle.style.fontWeight = "700";
    item.appendChild(name); item.appendChild(toggle);
    list.appendChild(item);

    const subDiv = document.createElement("div");
    subDiv.style.display = "none";
    subDiv.style.marginLeft = "12px";

    Object.keys(brandObj[mainModel]).forEach(subModel => {
      const subItem = document.createElement("div");
      subItem.textContent = subModel;
      subItem.style.padding = "8px 10px";
      subItem.onclick = (e) => {
        e.stopPropagation();
        $("modelValue").value = subModel;
        container.querySelector("span").textContent = subModel;
        list.style.display = "none";
        renderEngineDropdown(); // pasi zgjidhet modeli
      };
      subDiv.appendChild(subItem);
    });

    list.appendChild(subDiv);

    const toggleHandler = (e) => {
      e.stopPropagation();
      const open = subDiv.style.display !== "block";
      subDiv.style.display = open ? "block" : "none";
      toggle.textContent = open ? "-" : "+";
    };
    item.onclick = toggleHandler;
    toggle.onclick = toggleHandler;
  });

  container.appendChild(list);

  container.onclick = (e) => {
    e.stopPropagation();
    const show = list.style.display !== "block";
    document.querySelectorAll(".dropdown-list").forEach(l => l.style.display = "none");
    list.style.display = show ? "block" : "none";
    container.classList.toggle("open", show);
  };

  document.addEventListener("click", () => list.style.display = "none", { once: true });
}

// MOTORI (nxjerr Benzin/Dizel + kubikazhat direkt nga VEHICLES)
function renderEngineDropdown() {
  const brand = $("brand").value;
  const pickedSubModel = $("modelValue").value;
  const box = $("engineBox");

  const old = box.querySelector(".dropdown-list");
  if (old) old.remove();

  $("fuelValue").value = "";
  $("engineValue").value = "";
  box.querySelector("span").textContent = "-- Zgjidh --";

  if (!brand || !pickedSubModel) return;

  // gjej mainModel-in ku ekziston ky subModel
  const brandObj = VEHICLES[brand] || {};
  let fuels = null;
  for (const mainModel of Object.keys(brandObj)) {
    if (brandObj[mainModel] && brandObj[mainModel][pickedSubModel]) {
      fuels = brandObj[mainModel][pickedSubModel]; // { Benzin:[], Dizel:[] }
      break;
    }
  }
  if (!fuels) return;

  const list = document.createElement("div");
  list.className = "dropdown-list";

  Object.keys(fuels).forEach(fuel => {
    const item = document.createElement("div");
    item.style.display = "flex";
    item.style.justifyContent = "space-between";
    item.style.alignItems = "center";
    const name = document.createElement("span");
    name.textContent = fuel;
    const toggle = document.createElement("span");
    toggle.textContent = "+";
    toggle.style.fontWeight = "700";
    item.appendChild(name); item.appendChild(toggle);
    list.appendChild(item);

    const subDiv = document.createElement("div");
    subDiv.style.display = "none";
    subDiv.style.marginLeft = "12px";

    (fuels[fuel] || []).forEach(engine => {
      const d = document.createElement("div");
      d.textContent = engine;
      d.style.padding = "8px 10px";
      d.onclick = (e) => {
        e.stopPropagation();
        $("fuelValue").value = fuel;
        $("engineValue").value = engine;
        box.querySelector("span").textContent = `${fuel} â€” ${engine}`;
        list.style.display = "none";
        box.classList.remove("open");
      };
      subDiv.appendChild(d);
    });

    list.appendChild(subDiv);

    const toggleHandler = (e) => {
      e.stopPropagation();
      const open = subDiv.style.display !== "block";
      subDiv.style.display = open ? "block" : "none";
      toggle.textContent = open ? "-" : "+";
    };
    item.onclick = toggleHandler;
    toggle.onclick = toggleHandler;
  });

  box.appendChild(list);

  box.onclick = (e) => {
    e.stopPropagation();
    const show = list.style.display !== "block";
    document.querySelectorAll(".dropdown-list").forEach(l => l.style.display = "none");
    list.style.display = show ? "block" : "none";
    box.classList.toggle("open", show);
  };

  document.addEventListener("click", () => {
    list.style.display = "none";
    box.classList.remove("open");
  }, { once: true });
}

// INIT â€“ gjithÃ§ka pas DOMContentLoaded
document.addEventListener("DOMContentLoaded", () => {
  loadBrands();
  $("brand").addEventListener("change", renderModelsWithSubModels);
});






function buildCategoryDropdown() {
  const c = el('categoryContainer');
  const list = document.createElement('div');
  list.className = 'dropdown-list';
  c.appendChild(list);

  Object.keys(CATEGORIES).forEach(cat => {
    const d = document.createElement('div');
    d.textContent = cat;

    d.onclick = (e) => {
      e.stopPropagation();
      el('categoryValue').value = cat;
      c.querySelector('span').textContent = cat;
      list.style.display = 'none';
      populateParts(cat);
    };

    list.appendChild(d);
  });

  c.onclick = (e) => {
    e.stopPropagation();
    const show = list.style.display !== 'block';
    document.querySelectorAll('.dropdown-list').forEach(l => l.style.display = 'none');
    list.style.display = show ? 'block' : 'none';
    c.querySelector('.dropdown').classList.toggle('open', show);
  };

  document.addEventListener('click', () => list.style.display = 'none');
}





function populateParts(category) {
  const pc = el('partContainer');
  let list = pc.querySelector('.dropdown-list');

  if (!list) {
    list = document.createElement('div');
    list.className = 'dropdown-list';
    pc.appendChild(list);
  }

  list.innerHTML = '';

  (CATEGORIES[category] || []).forEach(part => {
    const d = document.createElement('div');
    d.textContent = part;

    d.onclick = (e) => {
      e.stopPropagation();
      el('partValue').value = part;
      pc.querySelector('span').textContent = part;
      list.style.display = 'none';
    };

    list.appendChild(d);
  });
}


/* âœ… VENDOS KÃ‹TU kÃ«tÃ« rresht */






const CATEGORIES = {
  "Gomat dhe produktet e lidhura": [
    "Goma makinash","KapakÃ« dekorativÃ« tÃ« rrotave","Bllokues rrotash (chocks)","Ã‡elÃ«s pÃ«r bulonat e rrotave"
  ],
  "Vajra dhe lÃ«ngje": [
    "Vaj motori","LÃ«ng ftohÃ«s motori","LÃ«ng frenash","Vaj kutie shpejtÃ«sish dhe lÃ«ng transmisioni"
  ],
  "Frena": [
    "FshegÃ«za frenash (balata)","Sensor konsumimi tÃ« fshegÃ«zave tÃ« frenave","Set montimi pÃ«r fshegÃ«za frenash","FshegÃ«za frenash me performancÃ« tÃ« lartÃ«"
  ],
  "Filtra": [
    "FiltÃ«r ajri","FiltÃ«r karburanti","FiltÃ«r kabine","FiltÃ«r vaji"
  ],
  "Motori": [
    "Elektrika e motorit","Sensor lambda","Sensor goditjeje","NjÃ«si kontrolli e motorit (ECU)"
  ],
  "Sistemi i fshirÃ«sve dhe larÃ«sve tÃ« xhamit": [
    "FshirÃ«se xhami","Krah fshirÃ«seje","Gome fshirÃ«seje","FshirÃ«se pÃ«r fenerÃ«"
  ],
  "Ndezja dhe parapÃ«rngrohja": [
    "FishekÃ« ndezjeje","BobinÃ« ndezjeje","FishekÃ« parandalues (dizel)","Modul kontrolli fishekÃ«sh"
  ],
  "Pezullimi (suspensioni)": [
    "QendÃ«r rrote","KushinetÃ« rrote","ArrÃ« qendre rrote","VulÃ« boshti, qendÃ«r rrote"
  ],
  "Elektrika": [
    "Alternator","Motor startues","Bateri","Rregullator alternatori"
  ],
  "Amortizimi": [
    "Amortizator","SustÃ« spirale"
  ],
};

/* ====== INIT ====== */
const token = localStorage.getItem('token');
if(!token){ location.href='/'; }
const el = id=>document.getElementById(id);
const msgEl = el('msg');
let editingId=null;
function showMsg(t,isErr=false){ msgEl.textContent=t; msgEl.style.color=isErr?'#ffb3b3':'#bfffe0'; setTimeout(()=>msgEl.textContent='',3000); }

/* Marka */
function populateBrands(){
  const s=el('brand');
  s.innerHTML='<option value="">-- Zgjidh Marken --</option>';
 
}
populateBrands();

/* Modeli dropdown me â€œ+â€ nÃ«n-modele */
function renderModelsWithSubModels() {
  const brandName = $("brand").value;
  const brandObj = VEHICLES[brandName];

  const container = $("model");
  const old = container.querySelector(".dropdown-list");
  if (old) old.remove();

  $("modelValue").value = "";
  container.querySelector("span").textContent = "-- Zgjidh --";

  if (!brandObj) return;

  const list = document.createElement("div");
  list.className = "dropdown-list";

  Object.keys(brandObj).forEach(mainModel => {
    const item = document.createElement("div");
    item.style.display = "flex";
    item.style.justifyContent = "space-between";
    const name = document.createElement("span");
    name.textContent = mainModel;
    const toggle = document.createElement("span");
    toggle.textContent = "+";
    toggle.style.fontWeight = "700";
    item.appendChild(name); item.appendChild(toggle);
    list.appendChild(item);

    const subDiv = document.createElement("div");
    subDiv.style.display = "none";
    subDiv.style.marginLeft = "12px";

    Object.keys(brandObj[mainModel]).forEach(subModel => {
      const subItem = document.createElement("div");
      subItem.textContent = subModel;
      subItem.style.padding = "8px 10px";
      subItem.onclick = (e) => {
        e.stopPropagation();
        $("modelValue").value = subModel;
        container.querySelector("span").textContent = subModel;
        list.style.display = "none";
        renderEngineDropdown(); 
      };
      subDiv.appendChild(subItem);
    });

    list.appendChild(subDiv);

    const toggleHandler = (e) => {
      e.stopPropagation();
      const open = subDiv.style.display !== "block";
      subDiv.style.display = open ? "block" : "none";
      toggle.textContent = open ? "-" : "+";
    };
    item.onclick = toggleHandler;
    toggle.onclick = toggleHandler;
  });

  container.appendChild(list);

  container.onclick = (e) => {
    e.stopPropagation();
    const show = list.style.display !== "block";
    document.querySelectorAll(".dropdown-list").forEach(l => l.style.display = "none");
    list.style.display = show ? "block" : "none";
    container.classList.toggle("open", show);
  };

  document.addEventListener("click", () => list.style.display = "none", { once: true });
}





el('brand').addEventListener('change', renderModelsWithSubModels);

/* Kategoria â†’ Emri i pjesÃ«s */
function buildCategoryDropdown(){
  const c=el('categoryContainer');
  const list=document.createElement('div'); list.className='dropdown-list'; c.appendChild(list);
  Object.keys(CATEGORIES).forEach(cat=>{
    const d=document.createElement('div'); d.textContent=cat;
    d.onclick=(e)=>{ e.stopPropagation(); el('categoryValue').value=cat; c.querySelector('span').textContent=cat; list.style.display='none'; populateParts(cat); };
    list.appendChild(d);
  });
  
  
  
  c.onclick = (e) => {
  e.stopPropagation();
  const show = list.style.display !== 'block';
  document.querySelectorAll('.dropdown-list').forEach(l => l.style.display='none');
  list.style.display = show ? 'block' : 'none';
  c.querySelector('.dropdown').classList.toggle('open', show);
};

  
  
  
  
  document.addEventListener('click',()=>list.style.display='none');
}
function populateParts(category){
  const pc=el('partContainer');
  let list=pc.querySelector('.dropdown-list');
  if(!list){ list=document.createElement('div'); list.className='dropdown-list'; pc.appendChild(list); }
  list.innerHTML='';
  (CATEGORIES[category]||[]).forEach(p=>{
    const d=document.createElement('div'); d.textContent=p;
    d.onclick=(e)=>{ e.stopPropagation(); el('partValue').value=p; pc.querySelector('span').textContent=p; list.style.display='none'; };
    list.appendChild(d);
  });
}
function buildPartDropdown(){
  const pc=el('partContainer');
  const list=document.createElement('div'); list.className='dropdown-list'; pc.appendChild(list);
  
  
  
  
  pc.onclick = (e) => {
  e.stopPropagation();
  const show = list.style.display !== 'block';
  document.querySelectorAll('.dropdown-list').forEach(l => l.style.display='none');
  list.style.display = show ? 'block' : 'none';
  pc.querySelector('.dropdown').classList.toggle('open', show);
};

  
  
  
  
  document.addEventListener('click',()=>list.style.display='none');
}
buildCategoryDropdown(); buildPartDropdown();

/* ====== API HELPERS ====== */
async function api(url, opts={}){ opts.headers=Object.assign({'Authorization':'Bearer '+token},opts.headers||{}); const r=await fetch(url,opts); return r; }




/* ====== SAVE ====== */
el('saveBtn').addEventListener('click', async ()=>{
  const brand = el('brand').value;
  const model = el('modelValue').value;
  const category = el('categoryValue').value;
  const name = el('partValue').value;
  
  
  
 const fuel = document.getElementById('fuelValue').value;
const engine = document.getElementById('engineValue').value;

  
  
  
  const qty = el('qty').value;
  const price = el('price').value;
  const note = el('note').value;
  const location = el('location').value;

  const images = el('image').files;

// Kontrollo numrin e fotove dhe shfaq mesazhin nÃ«se kalon 5
if (images.length > 5) {
  const msg = document.getElementById("photoLimitMsg");
  msg.style.display = "block";
  setTimeout(() => { msg.style.display = "none"; }, 4000); // fshihet pas 4 sekondash
}




  if (!brand || !model || !category || !name) {
    showMsg('PlotÃ«so tÃ« gjitha fushat!', true);
    return;
  }

  // âœ… krijo formData para se tÃ« fusim fotot
  const form = new FormData();
  form.append('brand', brand);
  form.append('model', model);
  form.append('category', category);
  form.append('name', name);
  
  form.append('fuel', document.getElementById('fuelValue').value);
form.append('engine', document.getElementById('engineValue').value);

  
  form.append('qty', qty);
  form.append('price', price);
  form.append('note', note);
  form.append('location', location);

  // âœ… shto deri nÃ« 5 foto nÃ« form
  for (let i = 0; i < Math.min(images.length, 5); i++) {
    form.append('images', images[i]);
  }

  try {
    const res = await api('/api/savePart', { method: 'POST', body: form });
    const data = await res.json();
    if (res.ok) {
      showMsg('âœ… Pjesa u ruajt me sukses!');
      clearForm();
      loadParts();
    } else {
      console.error(data);
      showMsg(data.error || 'Gabim gjatÃ« ruajtjes!', true);
    }
  } catch (e) {
    console.error(e);
    showMsg('Gabim gjatÃ« ruajtjes!', true);
  }
});



/* ====== LIST/SEARCH/RENDER ====== */
let lastRows=[];
function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]))}
let currentSearchWords=[];
function highlight(t){
  let out=escapeHtml(t||'');
  currentSearchWords.forEach(q=>{
    if(!q) return; const re=new RegExp(q.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'gi');
    out=out.replace(re,m=>`<span class="highlight">${escapeHtml(m)}</span>`);
  });
  return out;
}

function renderTable(rows){
  lastRows=rows;
  const tbody=document.querySelector('#partsTable tbody');
  tbody.innerHTML='';
  rows.forEach(r=>{
    const tr=document.createElement('tr');
	
	
let imgHtml = 'â€”';
let imgs = [];

// Lexo nga 'images' ose 'image' (si JSON ose string)
try {
  if (r.images && Array.isArray(r.images)) {
    imgs = r.images;
  } else if (r.image) {
    const parsed = JSON.parse(r.image);
    imgs = Array.isArray(parsed) ? parsed : [r.image];
  }
} catch {
  if (r.image) imgs = [r.image];
}

// Tani vizualizo si â€œstackâ€ ose vetÃ«m 1 foto
if (imgs.length > 0) {
  const firstImg = imgs[0];
  const extra = imgs.length - 1;

  if (imgs.length > 1) {
    const overlay = `<div class="photo-overlay">+${extra}</div>`;
    imgHtml = `
      <div class="photo-stack multi" data-images='${JSON.stringify(imgs)}'>
        <img src="${firstImg}" alt="foto" class="thumb main-photo">
        ${overlay}
      </div>`;
  } else {
    imgHtml = `
      <div class="photo-stack single" data-images='${JSON.stringify(imgs)}'>
        <img src="${firstImg}" alt="foto" class="thumb main-photo">
      </div>`;
  }
}





    
	
	tr.innerHTML = `
      <td>${r.id}</td>
      <td>${imgHtml}</td>
      <td>${highlight(r.brand)}</td>
      <td>${highlight(r.model)}</td>
      <td>${highlight(r.category)}</td>
      <td>${highlight(r.name)}</td>
      <td>${highlight(r.fuel||'')}</td>
      <td>${highlight(r.engine||'')}</td>
      <td>${r.qty ?? ''}</td>
      <td>${r.price ?? ''}</td>
      <td>${highlight(r.note||'')}</td>
      <td>${highlight(r.location||'')}</td>
      <td>${r.created_at || ''}</td>
      <td>
        <button class="small" data-action="edit" data-id="${r.id}">âœï¸</button>
        <button class="small" data-action="delete" data-id="${r.id}">ğŸ—‘ï¸</button>
		<button class="small" data-action="invoice" data-id="${r.id}">ğŸ§¾</button>
		<button class="small" data-action="label" data-id="${r.id}">ğŸ·ï¸</button>



      </td>
    `;
    tbody.appendChild(tr);
  });

  // actions
  tbody.querySelectorAll('button').forEach(b=>{
    b.onclick=async ()=>{
      const id=b.dataset.id, act=b.dataset.action;
      const row=lastRows.find(x=>String(x.id)===String(id));
      if(act==='edit'){ startEdit(row); }
      if (act === 'delete') {
  openDeletePopup(id);
}


    };
  });
  
}

async function loadParts(){
  try{
    const r = await api('/api/parts');
    if(!r.ok) throw new Error('Jo i autorizuar');
    const js = await r.json();

    renderTable(js.rows || []);

    // âœ… Llogarit numrin total tÃ« pjesÃ«ve
    const total = js.rows ? js.rows.length : 0;
    document.getElementById("totalParts").textContent = total;

    // âœ… Llogarit vlerÃ«n totale (â‚¬)
    const totalValue = js.rows.reduce((sum, item) => {
      const price = parseFloat(item.price) || 0;
      const qty = parseInt(item.qty) || 1;
      return sum + price * qty;
    }, 0);

    // Shfaq totalin me formatim tÃ« bukur
    document.getElementById("totalValue").textContent = totalValue.toFixed(2) + ' â‚¬';

  }catch(e){
    alert('Gabim: ' + e.message);
  }
}





// ğŸ” KÃ«rkim me tastierÃ« (ENTER)
el('searchInput').addEventListener('keydown', async (e) => {
  if (e.key !== 'Enter') return;
  
  
  
  // ğŸ”µ Efekti vizual pÃ«r butonin â€œKÃ«rkoâ€
  const btn = el('searchButton');
  btn.classList.add('flash');
  
  setTimeout(() => btn.classList.remove('flash'), 700);
  

  
  
  const q = el('searchInput').value.trim();
  if (!q) { 
    currentSearchWords = []; 
    return loadParts(); 
  }
  currentSearchWords = q.toLowerCase().split(/\s+/).filter(Boolean);
  try {
    const r = await api('/api/search?q=' + encodeURIComponent(q));
    if (!r.ok) throw new Error('Gabim nÃ« kÃ«rkim');
    const js = await r.json();
    renderTable(js.rows || []);
  } catch (err) {
    alert('Gabim: ' + err.message);
  }
});

// ğŸ”˜ Butoni â€œKÃ«rkoâ€
el('searchButton').addEventListener('click', async () => {
  const q = el('searchInput').value.trim();
  if (!q) { 
    currentSearchWords = []; 
    return loadParts(); 
  }
  currentSearchWords = q.toLowerCase().split(/\s+/).filter(Boolean);
  try {
    const r = await api('/api/search?q=' + encodeURIComponent(q));
    if (!r.ok) throw new Error('Gabim nÃ« kÃ«rkim');
    const js = await r.json();
    renderTable(js.rows || []);
  } catch (err) {
    alert('Gabim: ' + err.message);
  }
});

// ğŸ§¹ Butoni â€œPastroâ€
el('clearSearch').onclick = () => { 
  el('searchInput').value = ''; 
  currentSearchWords = []; 
  loadParts(); 
};




/* ====== EDIT ====== */
function startEdit(p){
  editingId=p.id;
  el('brand').value=p.brand||'';
  renderModelsWithSubModels();
  el('modelValue').value=p.model||'';
  el('model').querySelector('span').textContent=p.model||'';
  
  renderEngineDropdown();   // â† kjo linjÃ« e re

  
  
  // âœ… thirr dropdown-in e motorit

  
  
  el('categoryValue').value=p.category||'';
  el('categoryContainer').querySelector('span').textContent=p.category||'';
  populateParts(p.category||'');
  el('partValue').value=p.name||'';
  el('partContainer').querySelector('span').textContent=p.name||'';
  
  
document.getElementById('fuelValue').value = p.fuel || '';
document.getElementById('engineValue').value = p.engine || '';

if (p.fuel || p.engine) {
  document.getElementById('engineBox').querySelector('span').textContent =
    p.fuel + " â€” " + p.engine;
}

  
  
  el('qty').value=p.qty||1;
  el('price').value=(p.price??'');
  el('note').value=p.note||'';
  el('location').value=p.location||'';
  el('updateBtn').style.display='inline-block';
  el('cancelEdit').style.display='inline-block';
  el('saveBtn').style.display='none';
}

el('updateBtn').onclick=async ()=>{
  if(!editingId) return;
  // dÃ«rgo vetÃ«m fushat tekst + (opsional) image nÃ«se zgjidhet
  const form=new FormData();
  form.append('brand',el('brand').value);
  form.append('model',el('modelValue').value);
  form.append('category',el('categoryValue').value);
  form.append('name',el('partValue').value);
  
  
form.append('fuel', document.getElementById('fuelValue').value);
form.append('engine', document.getElementById('engineValue').value);

  
  
  
  form.append('qty',el('qty').value);
  form.append('price',el('price').value);
  form.append('note',el('note').value);
  form.append('location',el('location').value);
  for (let i = 0; i < Math.min(el('image').files.length, 5); i++) {
  form.append('images', el('image').files[i]);
}


  try{
    const r=await api('/api/parts/'+editingId,{method:'PUT',body:form});
    const js=await r.json();
    if(r.ok){ showMsg('âœï¸ Pjesa u pÃ«rditÃ«sua'); clearForm(); loadParts(); }
    else showMsg(js.error||'Gabim gjatÃ« pÃ«rditÃ«simit',true);
  }catch(e){ showMsg('Gabim rrjeti',true); }
};

el('cancelEdit').onclick=clearForm;






function clearForm(){
  editingId = null;

  el('brand').value = '';
  el('modelValue').value = '';
  el('model').querySelector('span').textContent = '-- Zgjidh --';

  el('categoryValue').value = '';
  el('categoryContainer').querySelector('span').textContent = 'Zgjidh kategorinÃ«';

  el('partValue').value = '';
  el('partContainer').querySelector('span').textContent = 'Zgjidh emrin e pjesÃ«s';

  // âœ… Reset motori
  document.getElementById('fuelValue').value = '';
  document.getElementById('engineValue').value = '';
  document.getElementById('engineBox').querySelector('span').textContent = '-- Zgjidh --';
  const oldList = document.querySelector('#engineBox .dropdown-list');
  if (oldList) oldList.remove();

  el('qty').value = 1;
  el('price').value = '';
  el('note').value = '';
  el('location').value = '';
  el('image').value = '';

  el('saveBtn').style.display = 'inline-block';
  el('updateBtn').style.display = 'none';
  el('cancelEdit').style.display = 'none';
}





/* ====== EXPORT ====== */
el('exportCSV').onclick=()=>{
  const rows=lastRows;
  let csv='ID,Marka,Modeli,Kategoria,Emri,Sasia,Ã‡mimi,Karburant,Kubikazhi,Lokacion,PÃ«rshkrimi,KrijuarMÃ«\n';
  rows.forEach(r=>{
    const line=[
      r.id,r.brand||'',r.model||'',r.category||'',r.name||'',
      r.qty||0,(r.price??''),r.fuel||'',r.engine||'',r.location||'',(r.note||''),(r.created_at||'')
    ].map(v=>`"${String(v).replace(/"/g,'""')}"`).join(',');
    csv+=line+'\n';
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='pjeset.csv'; a.click();
};

el('exportPDF').onclick=async ()=>{
  const rows=lastRows; if(!rows.length){ alert('Ska asnjÃ« rezultat pÃ«r tÃ« eksportuar'); return; }
  const head=['ID','Marka','Modeli','Kategoria','Emri','Sasia','Ã‡mimi','Karburant','Kubikazhi','Lokacion','PÃ«rshkrimi','KrijuarMÃ«'];
  const body=rows.map(r=>[r.id,r.brand||'',r.model||'',r.category||'',r.name||'',r.qty||'',r.price||'',r.fuel||'',r.engine||'',r.location||'',r.note||'',r.created_at||'']);
  const res=await api('/api/exportpdf',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({head,body})});
  if(!res.ok){ alert('Gabim gjatÃ« eksportit PDF'); return; }
  const blob=await res.blob(); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='pjeset.pdf'; a.click();
};



/* ğŸ”§ Kthe Marka, Karburantin dhe Kubikazhin nÃ« dropdown identik si modeli */
/* ğŸ”§ Rregullim final qÃ« tÃ« mos prishen dropdown-et ekzistuese */
function makeDropdownFromSelect(id) {
  const select = document.getElementById(id);
  if (!select) return;

  const container = document.createElement("div");
  container.className = "custom-select-box";

  const span = document.createElement("span");
  span.textContent = select.options[0]?.textContent || "-- Zgjidh --";
  container.appendChild(span);

  const hidden = document.createElement("input");
  hidden.type = "hidden";
  hidden.id = id + "Value";
  container.appendChild(hidden);

  const list = document.createElement("div");
  list.className = "custom-options-box";
  Array.from(select.options).forEach(opt => {
    const div = document.createElement("div");
    div.textContent = opt.textContent;
    div.onclick = e => {
      e.stopPropagation();
      span.textContent = opt.textContent;
      hidden.value = opt.value;
      list.style.display = "none";
    };
    list.appendChild(div);
  });

  container.appendChild(list);
  select.parentNode.replaceChild(container, select);

  container.onclick = e => {
    e.stopPropagation();
    const show = list.style.display !== "block";
    document.querySelectorAll(".custom-options-box").forEach(l => (l.style.display = "none"));
    list.style.display = show ? "block" : "none";
    container.classList.toggle("open", show);
  };

  document.addEventListener("click", () => (list.style.display = "none"));
}







// Korrigjon spacing qÃ« dropdown tÃ« mos ketÃ« asnjÃ« hendek vizual
["brand", "fuel", "engine"].forEach(id => {
  const el = document.getElementById(id + "Value")?.parentElement;
  if (el) el.style.position = "relative";
});






document.getElementById("logoutBtn").onclick = ()=>{
  localStorage.removeItem("token");
  location.href = "/";
};





// ğŸ–¼ï¸ Hap fotot aty ku ndodhesh dhe lejon kalimin me shigjeta + numÃ«rim
document.addEventListener('dblclick', (e) => {
  const stack = e.target.closest('.photo-stack');
  if (!stack) return;

  const imgs = JSON.parse(stack.dataset.images || '[]');
  if (!imgs.length) return;

  // Krijo popup-in aty ku ndodhesh
  const popup = document.createElement('div');
  popup.id = 'imagePopupDynamic';
  popup.style.position = 'absolute';
  popup.style.top = window.scrollY + 'px';
  popup.style.left = '0';
  popup.style.width = '100%';
  popup.style.height = '100vh';
  popup.style.display = 'flex';
  popup.style.justifyContent = 'center';
  popup.style.alignItems = 'center';
  popup.style.background = 'rgba(0,0,0,0.92)';
  popup.style.zIndex = '999999999';
  
  
    // ğŸ”´ Butoni X pÃ«r mbyllje popup-i
  const closeBtn = document.createElement('div');
  closeBtn.textContent = 'âœ–';
  closeBtn.style.position = 'absolute';
  closeBtn.style.top = '20px';
  closeBtn.style.right = '30px';
  closeBtn.style.fontSize = '28px';
  closeBtn.style.color = '#fff';
  closeBtn.style.cursor = 'pointer';
  closeBtn.style.fontWeight = 'bold';
  closeBtn.style.background = 'rgba(0,0,0,0.4)';
  closeBtn.style.borderRadius = '50%';
  closeBtn.style.padding = '6px 12px';
  closeBtn.style.boxShadow = '0 0 8px rgba(0,0,0,0.4)';
  closeBtn.onmouseover = () => (closeBtn.style.background = 'rgba(0,0,0,0.7)');
  closeBtn.onmouseout = () => (closeBtn.style.background = 'rgba(0,0,0,0.4)');
  closeBtn.onclick = () => popup.remove();

  popup.appendChild(closeBtn);

  
  
  

  // Krijo imazhin
  const img = document.createElement('img');
  img.src = imgs[0];
  img.style.maxWidth = '95%';
  img.style.maxHeight = '90vh';
  img.style.borderRadius = '14px';
  img.style.boxShadow = '0 0 40px rgba(255,255,255,0.3)';
  img.style.background = '#000';
  img.style.transition = 'opacity 0.3s ease';
  popup.appendChild(img);

  // Indeksi aktual
  let index = 0;

  // Krijo shigjetat
  const leftArrow = document.createElement('div');
  const rightArrow = document.createElement('div');

  [leftArrow, rightArrow].forEach(arrow => {
    arrow.style.position = 'absolute';
    arrow.style.top = '50%';
    arrow.style.transform = 'translateY(-50%)';
    arrow.style.fontSize = '42px';
    arrow.style.fontWeight = 'bold';
    arrow.style.color = '#fff';
    arrow.style.cursor = 'pointer';
    arrow.style.padding = '10px 20px';
    arrow.style.background = 'rgba(0,0,0,0.4)';
    arrow.style.borderRadius = '50%';
    arrow.style.userSelect = 'none';
    arrow.style.transition = 'background 0.2s';
    arrow.onmouseover = () => (arrow.style.background = 'rgba(0,0,0,0.7)');
    arrow.onmouseout = () => (arrow.style.background = 'rgba(0,0,0,0.4)');
  });

  leftArrow.textContent = 'â€¹';
  rightArrow.textContent = 'â€º';
  leftArrow.style.left = '30px';
  rightArrow.style.right = '30px';
  popup.appendChild(leftArrow);
  popup.appendChild(rightArrow);

  // â• NumÃ«ruesi poshtÃ« djathtas
  const counter = document.createElement('div');
  counter.style.position = 'absolute';
  counter.style.bottom = '20px';
  counter.style.right = '30px';
  counter.style.padding = '6px 12px';
  counter.style.background = 'rgba(0,0,0,0.5)';
  counter.style.borderRadius = '8px';
  counter.style.color = '#fff';
  counter.style.fontSize = '14px';
  counter.style.fontWeight = '500';
  counter.style.fontFamily = 'Poppins, sans-serif';
  counter.style.boxShadow = '0 0 8px rgba(0,0,0,0.4)';
  counter.textContent = `1 / ${imgs.length}`;
  popup.appendChild(counter);

  // Funksioni pÃ«r ndÃ«rrim fotoje
  function showImage(newIndex) {
    if (newIndex < 0) newIndex = imgs.length - 1;
    if (newIndex >= imgs.length) newIndex = 0;
    index = newIndex;
    img.style.opacity = '0';
    setTimeout(() => {
      img.src = imgs[index];
      img.style.opacity = '1';
      counter.textContent = `${index + 1} / ${imgs.length}`;
    }, 150);
  }

  leftArrow.onclick = (ev) => {
    ev.stopPropagation();
    showImage(index - 1);
  };

  rightArrow.onclick = (ev) => {
    ev.stopPropagation();
    showImage(index + 1);
  };

  // Mbyll kur klikon jashtÃ« imazhit
  popup.addEventListener('click', (ev) => {
    if (ev.target === popup) popup.remove();
  });

  document.body.appendChild(popup);
});



// Butoni "Shto pÃ«rdorues" â€“ vetÃ«m pÃ«r admin
const role = localStorage.getItem('role');
if (role !== 'admin') {
  document.getElementById('addUserBtn').style.display = 'none';
}

document.getElementById('addUserBtn').onclick = async () => {
  const username = prompt("Emri i pÃ«rdoruesit tÃ« ri:");
  const password = prompt("FjalÃ«kalimi:");
  if (!username || !password) return alert("PlotÃ«so fushat!");
  
  const res = await api('/api/addUser', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ username, password })
  });
  
  const data = await res.json();
  alert(data.success ? "âœ… " + data.message : "âš ï¸ " + (data.error || "Gabim"));
};


async function generateInvoice(id) {
  try {
    const r = await api('/api/parts');
    const js = await r.json();
    const part = js.rows.find(p => p.id === id);
    if (!part) return alert('Pjesa nuk u gjet.');

    const invoice = {
      date: new Date().toLocaleString(),
      brand: part.brand,
      model: part.model,
      category: part.category,
      name: part.name,
      fuel: part.fuel,
      engine: part.engine,
      qty: part.qty,
      price: part.price,
      total: (part.qty * part.price).toFixed(2),
      note: part.note,
      location: part.location,
      image: part.image ? JSON.parse(part.image)[0] : null
    };

    const res = await fetch('/api/invoice', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(invoice)
    });

    const blob = await res.blob();
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `Fature-${invoice.name}.pdf`;
    a.click();

  } catch (err) {
    alert('Gabim gjatÃ« gjenerimit tÃ« faturÃ«s: ' + err.message);
  }
}








async function printLabel(id) {
    const token = localStorage.getItem('token');

    const res = await fetch(`/api/label/${id}`, {
        headers: {
            "Authorization": "Bearer " + token
        }
    });

    if (!res.ok) {
        alert("Gabim: " + (await res.text()));
        return;
    }

    const blob = await res.blob();
    const url = URL.createObjectURL(blob);

    window.open(url, "_blank");
}







document.addEventListener("click", e => {
    const action = e.target.dataset.action;
    const id = e.target.dataset.id;

    if (!action || !id) return;

    if (action === "edit") {
        // edit
    }

    if (action === "delete") {
        // delete
    }

    if (action === "invoice") {
        generateInvoice(id); // âœ… ThÃ«rret faturÃ«n tÃ«nde
    }

    if (action === "label") {
        printLabel(id); // âœ… Print Etiketa (kÃ«tÃ« ta shkruaj unÃ«)
    }
});









// ğŸ”„ Butoni Rifresko
document.getElementById('refreshBtn').addEventListener('click', () => {
  loadParts();
  showMsg("ğŸ”„ Lista u rifreskua!");
});

// ğŸ”„ Butoni Rifresko me efekt animacioni
const refreshBtn = document.getElementById('refreshBtn');
refreshBtn.addEventListener('click', async () => {
  refreshBtn.classList.add('loading');
  await loadParts();
  showMsg("ğŸ”„ Lista u rifreskua!");
  setTimeout(() => refreshBtn.classList.remove('loading'), 800);
});



</script>



<script>
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("reportBtn").onclick = () => {
    const popup = document.getElementById("reportPopup");
    const content = document.getElementById("reportContent");

    content.innerHTML = `
      <h2 style="text-align:center; margin-bottom:20px;">ğŸ“Š Raporti i Shitjeve & Hyrjeve</h2>

      <div style="display:flex; gap:20px; flex-wrap:wrap; justify-content:center; margin-bottom:20px;">
        <div>
          <label>Data e fillimit:</label><br>
          <input type="date" id="startDate">
        </div>

        <div>
          <label>Data e mbarimit:</label><br>
          <input type="date" id="endDate">
        </div>

        <div>
          <label>Lloji:</label><br>
          <select id="reportType">
            <option value="all">TÃ« gjitha</option>
            <option value="sales">Shitjet</option>
            <option value="in">Hyrjet</option>
            <option value="profit">Fitimi</option>
          </select>
        </div>
      </div>

      <div style="text-align:center;">
        <button id="generateReport"
          style="padding:10px 20px; background:#00bcd4; border:none; border-radius:10px;
          font-weight:bold; cursor:pointer;">
          âœ… Shfaq Raportin
        </button>
      </div>

      <div id="raportRezultati" style="margin-top:20px;"></div>
    `;

    popup.style.display = "flex";
    document.getElementById("endDate").value = new Date().toISOString().split("T")[0];

    document.getElementById("generateReport").onclick = loadReportData;
  };

  // mbyll popup
  document.getElementById("closeReport").onclick = () =>
    document.getElementById("reportPopup").style.display = "none";

  document.getElementById("reportPopup").onclick = (e) => {
    if (e.target.id === "reportPopup") e.target.style.display = "none";
  };
});

async function loadReportData() {
  const start = document.getElementById("startDate").value;
  const end = document.getElementById("endDate").value;
  const type = document.getElementById("reportType").value;

  if (!start || !end) return alert("PlotÃ«so datat!");

  const res = await fetch(`/api/raport?start=${start}&end=${end}&type=${type}`, {
    headers: { Authorization: "Bearer " + localStorage.getItem("token") }
  });

  const data = await res.json();

  document.getElementById("raportRezultati").innerHTML = `
    <div style="background:#2c3e50; padding:15px; border-radius:12px;">
      <p>ğŸ’¸ Totali Shitjeve: <b>${data.sales_total.toFixed(2)} â‚¬</b></p>
      <p>ğŸ“¦ Totali Hyrjeve: <b>${data.in_total.toFixed(2)} â‚¬</b></p>
      <p>âš–ï¸ Fitimi Neto: <b>${data.profit.toFixed(2)} â‚¬</b></p>
      <p>ğŸ”§ PjesÃ« tÃ« Shitura: <b>${data.sold_count}</b></p>
    </div>
  `;
}
</script>

<script>
let deleteId = null;

function openDeletePopup(id) {
  deleteId = id;
  document.getElementById("deletePopup").style.display = "flex";
}

document.getElementById("btnCancel").onclick = () => {
  deleteId = null;
  document.getElementById("deletePopup").style.display = "none";
};

document.getElementById("btnNotSold").onclick = async () => {
  if (!deleteId) return;

  // âœ… Fshi pa shitje (nuk regjistrohet nÃ« raport)
  const res = await api('/api/parts/' + deleteId, { method: 'DELETE' });
  document.getElementById("deletePopup").style.display = "none";
  deleteId = null;
  loadParts();
};

document.getElementById("btnSold").onclick = async () => {
  if (!deleteId) return;

  // âœ… Regjistro shitjen + fshi
  await api('/api/sellAndDelete/' + deleteId, { method: 'POST' });

  document.getElementById("deletePopup").style.display = "none";
  deleteId = null;
  loadParts();
};
</script>


</body>
</html>
